{% extends 'base.html' %}
{% load static %}

{% block title %}Importar Equipos{% endblock %}

{% block header_title %}Importar Equipos desde Excel{% endblock %}

{% block content %}
<div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <div class="bg-white shadow-lg rounded-lg p-6 mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Importar Equipos</h1>

        {# Mensajes de Django #}
        {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                    <div class="p-3 rounded-md shadow-sm mb-2 
                        {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-800{% else %}bg-blue-100 text-blue-800{% endif %}" 
                        role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label for="excel_file" class="block text-sm font-medium text-gray-700">Seleccionar archivo Excel:</label>
                <input type="file" name="excel_file" id="excel_file" accept=".xlsx, .xls" required
                       class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-md cursor-pointer bg-gray-50
                              focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                <p class="mt-2 text-sm text-gray-500">
                    Por favor, asegúrate de que tu archivo Excel (.xlsx o .xls) tenga las columnas correctas.
                </p>
                <p class="mt-1 text-sm text-gray-500">
                    Descarga la plantilla de ejemplo para conocer el formato esperado: 
                    <a href="{% static 'templates/plantilla_importacion_equipos.xlsx' %}" 
                       class="text-blue-600 hover:text-blue-800 font-semibold" download>
                        Descargar Plantilla
                    </a>
                </p>
            </div>

            <button type="submit" 
                    class="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md 
                           hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 
                           transition duration-300 ease-in-out">
                Importar Equipos
            </button>
        </form>

        <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-700 mb-3">Instrucciones para la Importación:</h2>
            <ul class="list-disc list-inside text-gray-600 space-y-2">
                <li>El archivo debe ser en formato **.xlsx** o **.xls**.</li>
                <li>La primera fila de tu archivo Excel debe contener los encabezados de columna.</li>
                <li>Los nombres de las columnas deben coincidir exactamente con los siguientes:
                    <ul class="list-disc list-inside ml-5 text-gray-600">
                        <li>`codigo_interno` (Obligatorio)</li>
                        <li>`nombre` (Obligatorio)</li>
                        <li>`empresa` (Obligatorio - debe coincidir con el nombre de una empresa existente)</li>
                        <li>`tipo_equipo`</li>
                        <li>`marca`</li>
                        <li>`modelo`</li>
                        <li>`numero_serie`</li>
                        <li>`ubicacion` (Obligatorio - debe coincidir con el nombre de una ubicación existente)</li>
                        <li>`responsable` (Opcional - nombre de usuario existente)</li>
                        <li>`estado`</li>
                        <li>`fecha_adquisicion` (Formato YYYY-MM-DD o DD/MM/YYYY)</li>
                        <li>`rango_medida`</li>
                        <li>`resolucion`</li>
                        <li>`error_maximo_permisible`</li>
                        <li>`observaciones`</li>
                        <li>`version_formato`</li>
                        <li>`fecha_version_formato` (Formato YYYY-MM-DD o DD/MM/YYYY)</li>
                        <li>`codificacion_formato`</li>
                        <li>`frecuencia_calibracion_meses`</li>
                        <li>`frecuencia_mantenimiento_meses`</li>
                        <li>`frecuencia_comprobacion_meses`</li>
                    </ul>
                </li>
                <li>Las fechas deben estar en formato `YYYY-MM-DD` o `DD/MM/YYYY`.</li>
                <li>Los valores de `frecuencia_..._meses` y `error_maximo_permisible` pueden ser decimales (ej. 0.5, 1.5).</li>
                <li>Si un `codigo_interno` ya existe, el equipo **no será actualizado**, se ignorará para evitar sobrescribir datos accidentalmente.</li>
                <li>Si una `empresa` o `ubicacion` no existe, la importación de esa fila fallará. Asegúrate de que existan previamente.</li>
                <li>Si un `responsable` no existe, ese campo se dejará nulo.</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
